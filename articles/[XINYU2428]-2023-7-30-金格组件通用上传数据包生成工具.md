#  金格组件通用上传数据包生成工具

原创 XINYU2428 [ XINYU2428 ](javascript:void\(0\);)

**XINYU2428** ![]()

微信号 gh_65c38df19d17

功能介绍 信息安全打工人的学习分享及日常记录

____

___发表于_

收录于合集

### 0x00 前言

    未做处理的去直接引用金格组件，可能会导致系统产生任意文件上传漏洞，在历史漏洞中，因此出现问题的系统有很多。金格上传数据包与正常的数据包是有些许区别的，实际利用时往往需要反复调整验证数据包是否正确，本篇文章主要内容为：分享一个可以自动生成金格组件通用格式上传数据包的HTML小工具。

在以往的测试或代码审计中已多次遇到金格组件上传漏洞，利用或构造POC时，总是频繁的遇到如下三个问题：

  1. 调整上传内容后往往会使上传的字符串过长或过短，需要多次尝试才能传入想要的字符串。

  2. 修改文件名，文件路径等参数时，base64编码来编码去有些繁琐。

  3. 当响应包未到达预期时，无法第一时间确认是否是因为数据包格式错误引起的，还是漏洞已修复。

  

### 0x01 工具使用

为了能更方便的去构造此漏洞在不同系统中的POC，写了如下这个小工具。

工具的使用很简单，将HTML文件收藏至浏览器，使用时打开文件，填好参数和上传字符串，点击生成即可。

![]()  

  

金格上传数据包可以大概分为三个部分

第一部分为固定格式，用来校验数据包是否符合规范，其中89决定从什么位置开始读取上传字符串内容，104是读取字符串的长度

    
    
    DBSTEP V3.0     89                     0        104             DBSTEP=REJTVEVQ  
    

第二部分为传递参数

    
    
    OPTION=U0FWRUFTSFRNTA==  
    HTMLNAME=Ly4uL2h0bWxfdGVzdC5qc3A=  
    DIRECTORY=  
    

第三部分为上传内容

    
    
    <% out.println("vul");new java.io.File(application.getRealPath(request.getServletPath())).delete(); %>  
    

主要对如下两个细节做了自动化处理：

1.自动根据填充进去的参数和上传内容去计算，起始位置和上传字符串长度。

2.参数自动base64编码。

  

 **公众号回复 "0610" 获取下载链接。**

 **  
**

### 0x02 结语

  1. 审计代码时，可以留意下代码是否引用了金格组件，再搜索是否调用了金格组件的上传方法，如"MsgFileSave"，接着看下代码中的文件后缀和路径是否可控，可控就有意思了（通过金格组件上传的文件往往都不在web目录下，需要../去穿越）。

  2. 致远OA htmlofficeservlet 的那个上传漏洞，自己改了base64编码，不具备通用性，所以此工具不适用。

  3. 金格上传数据包具体的解析过程，大家可以找一份代码看下，具体我也有些忘记了哈哈。

  

  

  

预览时标签不可点

微信扫一扫  
关注该公众号

[知道了](javascript:;)

微信扫一扫  
使用小程序

****

[取消](javascript:void\(0\);) [允许](javascript:void\(0\);)

****

[取消](javascript:void\(0\);) [允许](javascript:void\(0\);)

： ， 。   视频 小程序 赞 ，轻点两下取消赞 在看 ，轻点两下取消在看

