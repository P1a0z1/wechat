#  对冰蝎4的魔改

孤*y  [ 渗透测试网络安全 ](javascript:void\(0\);)

**渗透测试网络安全** ![]()

微信号 STCSWLAQSEC

功能介绍 号主是一名网络安全行业的资深爱好者，在这里主要分享一些安全工具，应急响应，代码审计，漏洞挖掘，安全资讯等文章与技术。
请勿利用本公众号文章内的相关所有技术从事非法测试，如因此产生的一切不良后果与文章作者和本公众号无关。

____

___发表于_

收录于合集

**0x01 为什么要改冰蝎**

在每一次的渗透当中，都会遇见很多问题，比如一个工具需要java的一个低版本，另外一个又需要高版本，是可以在一个系统一个系统中存在多个java，但太麻烦，所以我就想在一个工具当中嵌入多个工具，套娃，然后增添一些功能方便各种操作，包括自定义成自己方便的类型，其次这是配合我上一篇文章可以结合使用的。

 **0x02  当前解决问题如下**

  1. 可以在冰蝎上进行漏洞利用。

  2. 小马拉大马的情况可以直接在冰蝎客户端上直接编译成加密文件。

  3. 增加了websocke接口，配合上一篇文章的内存马。

  4. 增加了一个特色专属马和刷新马的接口。

如果要使用请采用自己的data.db文件

 **先是写了部分exp**

![]()

属于exp仅供学习使用（截图吧，代码上传不了，被封了）

![]()

这部分exp可以自我补充一下，后续我可能会把他作为一个外部文件进行导入更为方便。初步的一个展示

为了进行使其使用冰蝎更为方便，我采取了在冰蝎上扩展了一个漏洞注入的功能，用于注入常用的一些漏洞，比如shiro，Weblogic，SpringBoot等漏洞，但由于我太懒了，写了四个漏洞就先搁置了，主要四个都是Weblogic的漏洞，其次可以导入连接jndi，或者是使用其工具嵌入，这篇文章会持续更新-->包括github

总体介绍一下：冰蝎这个架构，刚拿到手的时候其实很懵逼？dll?asp?xml?css?php?，哦~看完后发现，真神奇。

例如：php的一段

![]()

用一系列条件语句来尝试执行系统命令 $cmd，并捕获执行结果到 $kWJW 变量中。尝试了多种执行命令的方法，包括
system、proc_open、passthru、shell_exec 和
exec，以依次尝试可用的命令执行函数。如果没有可用的命令执行函数，则返回一个失败的消息，表明没有可用的函数来执行命令。最后，将执行结果以加密的形式存储在
$result 数组中，将结果以JSON格式返回，这就是大概的一个流程（一个ma）

 **增加了websocket命令执行接口**

增加了websocket命令执行接口因为大动干戈的话还不如写一个新的GUI，所以我主要是从MainController里面动工（这里面代码是真多，但最后我添加到了2315行）。连接websocket的部分代码，也就是上一篇文章的一个对应工具
--包括上面的内存马我好像也嵌入进去了，等我写到来看

![]()

 **0x03 增加了一个特别专属内存马和接口**

这里面有一个内存马很特别，你可以点击它，然后刷新它所在位置，然后返回给你，对方那边只会有访问日志，并不会有你连接日志，包括返回回来的url都是随机的，所以防火墙还不好拦，不是那几个品牌厂商的防火墙是检测不到的，在对应的工具上是存在一个

![]()

代码很简单，主要是马那边。

下面有一个马是对应的那个变化位置的马，挺好玩的，中间的连接工具可以自定义写一个，套个免杀的即可

![]()

 **0x04 文件转字节码转Base64**

然后做了一个无关紧要的功能，也就是编码，感觉有用点的也就是文件变字节码然后变成base64，做大马的时候感觉可以用

    
    
    public String classByBase64(String url){  
            File file=new File(url);  
            FileInputStream fileInputStream= null;  
            try {  
                fileInputStream = new FileInputStream(file);  
            } catch (FileNotFoundException e) {  
                throw new RuntimeException(e);  
            }  
            byte[] buffer= new byte[0];  
            try {  
                buffer = new byte[fileInputStream.available()];  
            } catch (IOException e) {  
                throw new RuntimeException(e);  
            }  
            try {  
                fileInputStream.read(buffer);  
            } catch (IOException e) {  
                throw new RuntimeException(e);  
            }  
            buffer.clone();  
            return new BASE64Encoder().encode(buffer);  
        }

 **0x05  总体展示一下**

做的具体功能使用*标识了的

![]()

原文地址:https://xz.aliyun.com/t/12896#toc-0

 若有侵权请联系删除

  

>  **免责声明**  
>
>
>
> 由于传播、利用本公众号渗透测试网络安全所提供的信息而造成的任何直接或者间接的后果及损失，均由使用者本人负责，公众号渗透测试网络安全及作者不为此承担任何责任，一旦造成后果请自行承担！如有侵权烦请告知，我们会立即删除并致歉。谢谢！

 **进交流群 请添加管理员**

备注：进群，将会自动邀请您加入 渗透测试网络安全 技术 官方 交流群

![]()

好文分享收藏赞一下最美点在看哦

  

![]() 还在等什么？赶紧点击下方名片开始学习吧！![]()

  

预览时标签不可点

微信扫一扫  
关注该公众号

[知道了](javascript:;)

微信扫一扫  
使用小程序

****

[取消](javascript:void\(0\);) [允许](javascript:void\(0\);)

****

[取消](javascript:void\(0\);) [允许](javascript:void\(0\);)

： ， 。   视频 小程序 赞 ，轻点两下取消赞 在看 ，轻点两下取消在看

